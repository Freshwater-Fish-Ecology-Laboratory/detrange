---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-"
)
```

# detrange

<!-- badges: start -->
<!-- badges: end -->

## Introduction 

`detrange` estimates detection range from multiple stations within a passive acoustic telemetry array. We use the definition of detection range from Kessel et al. (2014):

>"... the relationship between detection probability and the distance between the receiver and tag. This can be presented graphically in the form of a logistic curve of detection probability, derived from the results of detection range testing in the field."

Given the detection range, `detrange` also estimates the distance (with confidence intervals) at which a specified level of detection efficiency is achieved. Typically, we are interested in the midpoint of the detection range (i.e. distance at which 50% of pings are detected).

Under the hood, `detrange` uses a Bayesian mixed-effects logistic linear regression model. Station is treated as a random effect (slope and intercept) and Distance is the sole covariate.

## Demonstration

### Data

`detrange` expects data typical of detection range testing. These data must include columns:  

- `Station` (factor)  
- `Distance` (numeric)  
- `Detects` (integer)  
- `Pings` (integer)

`Pings` is the expected number of detections. An example dataset `range_test` is included for reference.

```{r data}
library(detrange)

### view example dataset
data <- range_test
data
```

### Analysis
To estimate detection range, use `dr_analyse()`. The `priors` argument allows the user to change the default priors (in JAGS language), `de_target` specifies the desired detection efficiency to estimate distance at and `nthin` can be adjusted to improve model convergence. Note a single prior can be changed and the default priors will remain for the rest.
```{r}
### set target DE to 50%
de_target <- 0.5
### replace default prior for bIntercept
prior_bIntercept <- list(bIntercept = "dnorm(10, 5^-2)") 

analysis <- dr_analyse(data, de_target = de_target, priors = prior_bIntercept, nthin = 1L)
```
The output of `dr_analyse()` is an object of class `mbr`. It can be manipulated using any functions within the [mbr package](https://github.com/poissonconsulting/mbr). For convenience, `detrange` provides some functions to summarise/visualise the analysis.

```{r}
### plot predicted values
dr_plot_predicted(analysis, de_target = de_target)
```

```{r}
### get midpoint estimates
dr_analysis_midpoint(analysis)
```

```{r}
### coefficient table
dr_analysis_coef(analysis)
```

## Code of Conduct

Please note that the detrange project is released with a [Contributor Code of Conduct](https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html). By contributing to this project, you agree to abide by its terms.

## Installation

Install the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("Freshwater-Fish-Ecology-Laboratory/detrange")
```
